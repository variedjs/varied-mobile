<template>
  <div :class="b('wrapper',{ wider, space, 'letter': theme === 'letter' || theme === 'letter-number' })">
    <button
      type="button"
      @touchstart="onTouchStart"
      @touchmove="onTouchMove"
      @touchend="onTouchEnd"
      @touchcancel="onTouchEnd"
      :class="b([
      color,
      {
      large: large,
      active: active,
      delete: type === 'delete',
    },
    ])"
    >
      <slot v-if="type === 'delete' && !text" name="delete">
        <svg
          :class="b('delete-icon')"
          viewBox="0 0 32 22"
          xmlns="http://www.w3.org/2000/svg">
          <path
            d="M28.016 0A3.991 3.991 0 0132 3.987v14.026c0 2.2-1.787 3.987-3.98 3.987H10.382c-.509 0-.996-.206-1.374-.585L.89 13.09C.33 12.62 0 11.84 0 11.006c0-.86.325-1.62.887-2.08L9.01.585A1.936 1.936 0 0110.383 0zm0 1.947H10.368L2.24 10.28c-.224.226-.312.432-.312.73 0 .287.094.51.312.729l8.128 8.333h17.648a2.041 2.041 0 002.037-2.04V3.987c0-1.127-.915-2.04-2.037-2.04zM23.028 6a.96.96 0 01.678.292.95.95 0 01-.003 1.377l-3.342 3.348 3.326 3.333c.189.188.292.43.292.679 0 .248-.103.49-.292.679a.96.96 0 01-.678.292.959.959 0 01-.677-.292L18.99 12.36l-3.343 3.345a.96.96 0 01-.677.292.96.96 0 01-.678-.292.962.962 0 01-.292-.68c0-.248.104-.49.292-.679l3.342-3.348-3.342-3.348A.963.963 0 0114 6.971c0-.248.104-.49.292-.679A.96.96 0 0114.97 6a.96.96 0 01.677.292l3.358 3.348 3.345-3.348A.96.96 0 0123.028 6z"
            fill="currentColor"
          />
        </svg>
      </slot>
      <slot v-else-if="type === 'extra' && !text" name="extraKey">
        <svg
          :class="b('collapse-icon')"
          viewBox="0 0 30 24"
          xmlns="http://www.w3.org/2000/svg">
          <path
            d="M25.877 12.843h-1.502c-.188 0-.188 0-.188.19v1.512c0 .188 0 .188.188.188h1.5c.187 0 .187 0 .187-.188v-1.511c0-.19 0-.191-.185-.191zM17.999 10.2c0 .188 0 .188.188.188h1.687c.188 0 .188 0 .188-.188V8.688c0-.187.004-.187-.186-.19h-1.69c-.187 0-.187 0-.187.19V10.2zm2.25-3.967h1.5c.188 0 .188 0 .188-.188v-1.7c0-.19 0-.19-.188-.19h-1.5c-.189 0-.189 0-.189.19v1.7c0 .188 0 .188.19.188zm2.063 4.157h3.563c.187 0 .187 0 .187-.189V4.346c0-.19.004-.19-.185-.19h-1.69c-.187 0-.187 0-.187.188v4.155h-1.688c-.187 0-.187 0-.187.189v1.514c0 .19 0 .19.187.19zM14.812 24l2.812-3.4H12l2.813 3.4zm-9-11.157H4.31c-.188 0-.188 0-.188.19v1.512c0 .188 0 .188.188.188h1.502c.187 0 .187 0 .187-.188v-1.511c0-.19.01-.191-.189-.191zm15.937 0H8.25c-.188 0-.188 0-.188.19v1.512c0 .188 0 .188.188.188h13.5c.188 0 .188 0 .188-.188v-1.511c0-.19 0-.191-.188-.191zm-11.438-2.454h1.5c.188 0 .188 0 .188-.188V8.688c0-.187 0-.187-.188-.189h-1.5c-.187 0-.187 0-.187.189V10.2c0 .188 0 .188.187.188zM27.94 0c.563 0 .917.21 1.313.567.518.466.748.757.748 1.51v14.92c0 .567-.188 1.134-.562 1.512-.376.378-.938.566-1.313.566H2.063c-.563 0-.938-.188-1.313-.566-.562-.378-.75-.945-.75-1.511V2.078C0 1.51.188.944.562.567.938.189 1.5 0 1.875 0zm-.062 2H2v14.92h25.877V2zM5.81 4.157c.19 0 .19 0 .19.189v1.762c-.003.126-.024.126-.188.126H4.249c-.126-.003-.126-.023-.126-.188v-1.7c-.187-.19 0-.19.188-.19zm10.5 2.077h1.503c.187 0 .187 0 .187-.188v-1.7c0-.19 0-.19-.187-.19h-1.502c-.188 0-.188.001-.188.19v1.7c0 .188 0 .188.188.188zM7.875 8.5c.187 0 .187.002.187.189V10.2c0 .188 0 .188-.187.188H4.249c-.126-.002-.126-.023-.126-.188V8.625c.003-.126.024-.126.188-.126zm7.875 0c.19.002.19.002.19.189v1.575c-.003.126-.024.126-.19.126h-1.563c-.126-.002-.126-.023-.126-.188V8.625c.002-.126.023-.126.189-.126zm-6-4.342c.187 0 .187 0 .187.189v1.7c0 .188 0 .188-.187.188H8.187c-.126-.003-.126-.023-.126-.188V4.283c.003-.126.024-.126.188-.126zm3.94 0c.185 0 .372 0 .372.189v1.762c-.002.126-.023.126-.187.126h-1.75C12 6.231 12 6.211 12 6.046v-1.7c0-.19.187-.19.187-.19z"
            fill="currentColor"
          />
        </svg>
      </slot>
      <slot v-else-if="type === 'space' && !text" name="extraKey">
        <svg :class="b('space-icon')" t="1590154416403" class="icon" viewBox="0 0 2048 1024" version="1.1"
             xmlns="http://www.w3.org/2000/svg" p-id="9791" width="48" height="48">
          <path
            d="M43.885714 760.685714a43.885714 43.885714 0 0 1 43.885715 43.885715v175.542857a43.885714 43.885714 0 1 1-87.771429 0V804.571429a43.885714 43.885714 0 0 1 43.885714-43.885715z"
            p-id="9792" fill="#2c2c2c"></path>
          <path
            d="M43.885714 936.228571h1960.228572a43.885714 43.885714 0 1 1 0 87.771429H43.885714a43.885714 43.885714 0 1 1 0-87.771429z"
            p-id="9793" fill="#2c2c2c"></path>
          <path
            d="M2004.114286 760.685714a43.885714 43.885714 0 0 1 43.885714 43.885715v175.542857a43.885714 43.885714 0 1 1-87.771429 0V804.571429a43.885714 43.885714 0 0 1 43.885715-43.885715z"
            p-id="9794" fill="currentColor"></path>
        </svg>
      </slot>
      <slot v-else-if="type === 'capital' && !text" name="capital">
        <svg v-if="$parent.capital" :class="b('capital-icon')" t="1590151420889" class="icon" viewBox="0 0 1024 1024"
             version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8316" width="32" height="32">
          <path
            d="M545.28 94.435556L969.955556 558.648889c46.08 49.208889 28.444444 90.737778-40.106667 90.737778h-170.666667v221.297777a73.671111 73.671111 0 0 1-73.955555 73.671112H341.333333a73.955556 73.955556 0 0 1-73.955555-73.671112v-221.297777h-170.666667c-68.266667 0-85.333333-40.675556-39.822222-90.737778L478.72 94.435556A44.657778 44.657778 0 0 1 540.444444 90.737778l3.697778 3.697778z"
            p-id="8317" fill="#1296db"></path>
        </svg>
        <svg v-else :class="b('capital-icon')" t="1590151420889" class="icon" viewBox="0 0 1024 1024" version="1.1"
             xmlns="http://www.w3.org/2000/svg" p-id="8316" width="32" height="32">
          <path
            d="M545.28 94.435556L969.955556 558.648889c46.08 49.208889 28.444444 90.737778-40.106667 90.737778h-170.666667v221.297777a73.671111 73.671111 0 0 1-73.955555 73.671112H341.333333a73.955556 73.955556 0 0 1-73.955555-73.671112v-221.297777h-170.666667c-68.266667 0-85.333333-40.675556-39.822222-90.737778L478.72 94.435556A44.657778 44.657778 0 0 1 540.444444 90.737778l3.697778 3.697778z"
            p-id="8317" fill="#bfbfbf"></path>
        </svg>
      </slot>
      <span v-else>{{text}}</span>
      <template v-if="loading">
        <icon
          name="spinner"
          :class="b('loading-icon')"
        />
      </template>
    </button>
  </div>
</template>
<script>
  import TouchMixin from '../mixins/touch';
  import create from '../utils/create';

  export default create({
    mixins: [TouchMixin],

    name: "key",

    props: {
      theme: String,
      type: String,
      text: [Number, String],
      color: String,
      wider: Boolean,
      space: Boolean,
      large: Boolean,
      loading: Boolean,
    },

    data() {
      return {
        active: false
      }
    },

    computed: {},

    methods: {
      onTouchStart(event) {
        // compatible with Vue 2.6 event bubble bug
        event.stopPropagation();

        this.touchStart(event);
        this.active = true;
      },

      onTouchMove(event) {
        this.touchMove(event);

        if (this.direction) {
          this.active = false;
        }
      },

      onTouchEnd() {
        if (this.active) {
          this.active = false;
          let text = this.text;
          if (this.type === 'space') {
            text = ' ';
          }
          this.$emit('press', text, this.type);
        }
      },
    },
  });

</script>
